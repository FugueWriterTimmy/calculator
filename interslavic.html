<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Interslavic Cyrillic ↔ Latin Converter</title>
<style>
  body {
    font-family: sans-serif;
    margin: 20px;
    background: #f7f7f7;
    color: #222;
    transition: background 0.3s, color 0.3s;
  }
  body.dark {
    background: #1e1e1e;
    color: #ddd;
  }
  h1 {
    text-align: center;
    margin-bottom: 20px;
  }
  .controls {
    text-align: center;
    margin-bottom: 20px;
  }
  button {
    padding: 6px 12px;
    font-size: 16px;
    border-radius: 5px;
    cursor: pointer;
    border: none;
  }
  .converter {
    display: flex;
    gap: 20px;
    justify-content: center;
    flex-wrap: wrap;
  }
  .box {
    flex: 1 1 400px;
    display: flex;
    flex-direction: column;
  }
  textarea {
    width: 100%;
    min-height: 250px;
    font-size: 18px;
    padding: 10px;
    border-radius: 6px;
    border: 1px solid #ccc;
    resize: vertical;
    box-sizing: border-box;
    background: #fff;
    color: #000;
    transition: background 0.3s, color 0.3s;
  }
  body.dark textarea {
    background: #2e2e2e;
    color: #ddd;
    border-color: #555;
  }
  label {
    margin-bottom: 8px;
    font-weight: bold;
  }
</style>
</head>
<body>

<h1>Interslavic Cyrillic ↔ Latin Converter</h1>

<div class="controls">
  <button id="darkToggle">Toggle Dark Mode</button>
</div>

<div class="converter">
  <div class="box">
    <label for="cyrillic">Cyrillic</label>
    <textarea id="cyrillic" placeholder="Type Cyrillic here…"></textarea>
  </div>
  <div class="box">
    <label for="latin">Latin</label>
    <textarea id="latin" placeholder="Type Latin here…"></textarea>
  </div>
</div>

<script>
const vowels = "aeiouěAEIOUĚ";

// Cyrillic ↔ Latin mappings (digraphs first)
const cyrToLat = {
  "ДЖ":"DŽ","ддж":"dž",
  "Љ":"LJ","љ":"lj",
  "Њ":"NJ","њ":"nj",
  "А":"A","Б":"B","В":"V","Г":"G","Д":"D","Е":"E","Є":"Ě",
  "Ж":"Ž","З":"Z","И":"I","Ы":"Y","Ј":"J","К":"K","Л":"L",
  "М":"M","Н":"N","О":"O","П":"P","Р":"R","С":"S","Т":"T",
  "У":"U","Ф":"F","Х":"H","Ц":"C","Ч":"Č","Ш":"Š",
  "а":"a","б":"b","в":"v","г":"g","д":"d","е":"e","є":"ě",
  "ж":"ž","з":"z","и":"i","ы":"y","ј":"j","к":"k","л":"l",
  "м":"m","н":"n","о":"o","п":"p","р":"r","с":"s","т":"t",
  "у":"u","ф":"f","х":"h","ц":"c","ч":"č","ш":"š"
};

const latToCyr = {
  "DŽ":"ДЖ","dž":"ддж",
  "LJ":"Љ","lj":"љ",
  "NJ":"Њ","nj":"њ",
  "A":"А","a":"а","B":"Б","b":"б","V":"В","v":"в","G":"Г","g":"г",
  "D":"Д","d":"д","E":"Е","e":"е","Ě":"Є","ě":"є",
  "Ž":"Ж","ž":"ж","Z":"З","z":"з","I":"И","i":"и",
  "Y":"Ы","y":"ы","J":"Ј","j":"ј","K":"К","k":"к","L":"Л","l":"л",
  "M":"М","m":"м","N":"Н","n":"н","O":"О","o":"о","P":"П","p":"п",
  "R":"Р","r":"р","S":"С","s":"с","T":"Т","t":"т","U":"У","u":"у",
  "F":"Ф","f":"ф","H":"Х","h":"х","C":"Ц","c":"ц",
  "Č":"Ч","č":"ч","Š":"Ш","š":"ш"
};

const latSeqs = Object.keys(latToCyr).sort((a,b)=>b.length - a.length);

function isVowel(ch) { return vowels.includes(ch); }

// Convert Cyrillic → Latin
function cyrillicToLatin(text) {
  let res = "";
  for (let i = 0; i < text.length; i++) {
    if (i + 1 < text.length) {
      const two = text[i] + text[i+1];
      if (cyrToLat[two] !== undefined) { res += cyrToLat[two]; i++; continue; }
    }
    res += cyrToLat[text[i]] ?? text[i];
  }
  return res;
}

// Convert Latin → Cyrillic with special NJ rule
function latinToCyrillic(text) {
  // Split into words to handle penultimate position
  return text.split(/(\s+)/).map(word => { // keep spaces
    let res = "";
    let i = 0;
    while (i < word.length) {
      let matched = false;
      for (const seq of latSeqs) {
        if (word.substr(i, seq.length) === seq) {
          // Special NJ rule: penultimate position, between vowels
          if (seq.toLowerCase() === "nj" && word.length >= 3) {
            const penultIdx = word.length - 3;
            if (i === penultIdx && isVowel(word[i-1]) && isVowel(word[i+2])) {
              res += "н" + "j"; // two separate Cyrillic letters
              i += 2;
              matched = true;
              break;
            }
          }
          res += latToCyr[seq];
          i += seq.length;
          matched = true;
          break;
        }
      }
      if (!matched) { res += word[i]; i++; }
    }
    return res;
  }).join("");
}

// Event listeners
document.addEventListener("DOMContentLoaded", () => {
  const cyrBox = document.getElementById("cyrillic");
  const latBox = document.getElementById("latin");

  cyrBox.addEventListener("input", () => { latBox.value = cyrillicToLatin(cyrBox.value); });
  latBox.addEventListener("input", () => { cyrBox.value = latinToCyrillic(latBox.value); });

  // Dark mode toggle
  const darkBtn = document.getElementById("darkToggle");
  darkBtn.addEventListener("click", () => document.body.classList.toggle("dark"));
});
</script>

</body>
</html>
